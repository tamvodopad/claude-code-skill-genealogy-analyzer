# Genealogy Analyzer — скилл для Claude Code

**Автор:** Константин Попов ([tamvodopad.com](https://tamvodopad.com))

Скилл для Claude Code, анализирующий генеалогические данные в формате GEDCOM. Специализация — поиск аномалий в датах браков, рождений и смертей с учётом русских православных традиций (до 1917 года).

## Возможности

### Анализ дат и событий
- **Аналитика рождений** — распределение по годам, месяцам, сезонам зачатия
- **Анализ дат браков** на соответствие православным традициям
- **Поиск браков в запретные периоды** (посты)
- **Выявление нетипичных дат свадеб** (лето, страда)
- **Проверка дат рождения первых детей** относительно брака (добрачная беременность)

### Проверка имён
- **Проверка соответствия имён дням крещения по святцам**
- **Поиск родственников-тёзок** для имён, не соответствующих святцам
- **Проверка отчеств** — соответствие отчества ребёнка имени отца

### Валидация данных
- **Детектор аномалий дат** — рождение после смерти родителя, слишком молодые/старые родители
- **Оценка качества данных** — полнота дат, мест, связей
- **Анализ «кирпичных стен»** — тупиков без известных родителей

### Паттерны
- **«Замещающие имена»** — традиция называть ребёнка именем умершего младенца
- Поддержка юлианского календаря

### Продвинутая аналитика
- **Коэффициент инбридинга (COI)** — расчёт по алгоритму Райта, поиск браков между родственниками
- **Географическая миграция** — анализ перемещений семей, происхождение по местам
- **Продолжительность жизни** — статистика по периодам, полу, местам, долгожители
- **Статистика поколений** — интервалы между поколениями, возраст родительства
- **Анализ фамилий** — этимология, распределение, мужские линии

## Установка

### Claude Code

1. Клонируйте репозиторий:
```bash
git clone https://github.com/tamvodopad/claude-code-skill-genealogy-analyzer.git
```

2. Создайте символическую ссылку в директории скиллов:
```bash
ln -s /path/to/claude-code-skill-genealogy-analyzer ~/.claude/skills/genealogy-analyzer
```

Или скопируйте файлы:
```bash
cp -r claude-code-skill-genealogy-analyzer ~/.claude/skills/genealogy-analyzer
```

3. Скилл автоматически станет доступен в Claude Code.

**Проверка:** запустите `claude` и попросите «проанализируй GEDCOM файл на аномалии».

---

### OpenAI Codex CLI

[Codex CLI](https://developers.openai.com/codex/cli/) поддерживает скиллы в формате, совместимом с этим репозиторием.

1. Убедитесь, что скиллы включены в `~/.codex/config.toml`

2. Клонируйте репозиторий в директорию скиллов Codex:
```bash
git clone https://github.com/tamvodopad/claude-code-skill-genealogy-analyzer.git ~/.codex/skills/genealogy-analyzer
```

3. Переименуйте файл скилла (Codex использует `SKILL.md`):
```bash
cd ~/.codex/skills/genealogy-analyzer
# SKILL.md уже есть в репозитории, Codex его подхватит
```

4. Перезапустите Codex CLI.

**Документация:** [Create Skills](https://developers.openai.com/codex/skills/create-skill/) | [Skills Catalog](https://github.com/openai/skills)

---

### Cursor IDE

[Cursor](https://cursor.com) поддерживает кастомные правила и контекст через систему Rules.

#### Способ 1: Project Rules (рекомендуемый)

1. **Создайте директорию правил** в корне проекта с GEDCOM файлом:
```bash
mkdir -p .cursor/rules
```

2. **Создайте файл правила** `.cursor/rules/genealogy.mdc`:
```markdown
---
description: "Genealogy analysis with Russian Orthodox traditions"
globs: ["*.ged", "*.gedcom"]
alwaysApply: false
---

# Genealogy Analyzer Context

При работе с GEDCOM файлами используй следующий контекст...
```

3. **Скопируйте содержимое `SKILL.md`** в файл правила (после frontmatter)

4. **Перезапустите Cursor** — правило будет загружаться при работе с `.ged` файлами

#### Способ 2: Глобальные User Rules

1. Откройте **Cursor → Settings → Cursor Settings → Rules for AI**
2. Добавьте ключевые инструкции из `SKILL.md`:
```
При анализе генеалогических данных (GEDCOM):
- Учитывай юлианский календарь (до 1918)
- Проверяй даты браков на соответствие православным традициям
- Помни о запретных периодах: Великий пост, Петров пост, Успенский пост, Рождественский пост
```

#### Способ 3: Файл .cursorrules (legacy)

Создайте `.cursorrules` в корне проекта:
```bash
cp /path/to/genealogy-analyzer/SKILL.md .cursorrules
```

> **Примечание:** `.cursorrules` — устаревший подход. Рекомендуется использовать `.cursor/rules/`.

#### Agent Skills (экспериментально)

Agent Skills доступны в nightly-версии Cursor:
1. **Cursor → Settings → Beta → Update Channel → Nightly**
2. Создайте `.cursor/commands/analyze-marriages.md`:
```markdown
---
description: "Analyze GEDCOM for atypical marriages"
---

Проанализируй GEDCOM файл {{file}} на аномальные браки по православным традициям.
```

**Документация:** [Cursor Rules](https://cursor.com/docs/context/rules) | [awesome-cursorrules](https://github.com/PatrickJS/awesome-cursorrules)

---

### YandexGPT / Yandex AI Studio

[Yandex AI Studio](https://yandex.cloud/ru/services/ai-studio) позволяет создавать ИИ-агентов с системными инструкциями и базами знаний без программирования.

#### Создание агента-генеалога

1. **Откройте [AI Studio](https://yandex.cloud/ai-studio)** в Yandex Cloud Console

2. **Создайте нового агента** в Agent Atelier:
   - Имя: `Генеалогический анализатор`
   - Описание: `Анализ GEDCOM файлов с учётом православных традиций`

3. **Добавьте системные инструкции** (скопируйте из `SKILL.md`):
```
Ты — эксперт по генеалогии и русской православной истории.
Анализируй GEDCOM данные с учётом:
- Юлианского календаря (до 1918)
- Православных постов и запретных периодов для венчания
- Святцев и традиций имянаречения
- Крестьянского быта и сельскохозяйственного цикла

При анализе дат браков проверяй:
- Великий пост (нельзя венчаться)
- Петров, Успенский, Рождественский посты
- Святки, Масленицу, Пасхальную неделю
```

4. **Загрузите базу знаний**:
   - Файл `SKILL.md` — полные инструкции по анализу
   - Документы с описанием православных традиций
   - Таблицы святцев (опционально)

5. **Настройте поведение**:
   - Формат ответов: структурированный с emoji-маркерами
   - Стиль: профессиональный, но понятный
   - Ограничения: «не давай юридических советов», «указывай на неопределённость в данных»

6. **Подключите инструменты** через MCP Hub (опционально):
   - Создайте MCP-сервер для парсинга GEDCOM
   - Интегрируйте скрипты анализа как API

#### Тестирование

Примеры запросов для проверки агента:
- «Проанализируй эти данные о браке: 15 марта 1895 года»
- «Почему имя Иван не соответствует дате крещения 3 февраля?»
- «Какие посты были в 1910 году?»

**Документация:** [Yandex AI Studio](https://yandex.cloud/ru/docs/ai-studio/) | [Agent Atelier](https://yandex.cloud/ru/docs/ai-studio/concepts/agents/) | [MCP Hub](https://yandex.cloud/ru/docs/ai-studio/concepts/)

## Использование

Скилл активируется когда вы:
- Просите проанализировать GEDCOM файл на аномалии
- Хотите найти нетипичные даты браков
- Спрашиваете о соответствии дат православным традициям
- Просите исследовать конкретную семью

### Примеры запросов

- «Проанализируй мой GEDCOM файл на аномалии»
- «Найди нетипичные даты браков в tree.ged»
- «Проверь, соответствует ли эта дата брака православным традициям»
- «Найди браки в запретные периоды до 1930 года»

### Автономные скрипты

#### Аналитика по датам рождения
```bash
python3 analyze_births.py tree.ged           # Базовая аналитика
python3 analyze_births.py tree.ged --list    # С полным списком рождений
```

Выводит:
- Распределение по десятилетиям и месяцам
- Сезоны зачатия (рождение минус 9 месяцев)
- Самые ранние и поздние рождения
- Пиковые годы рождений

#### Анализ дат браков
```bash
python3 analyze_marriages.py tree.ged
python3 analyze_marriages.py tree.ged --before 1920
python3 analyze_marriages.py tree.ged --before 1930 --output report.txt
```

Выводит:
- Браки в запретные периоды (посты)
- Нетипичные даты (лето, страда)
- Типичные свадебные периоды

#### Проверка дат рождения первых детей
```bash
python3 check_first_child.py tree.ged
python3 check_first_child.py tree.ged --threshold 200  # Порог в днях
```

Выявляет возможную добрачную беременность:
- Критические случаи (ребёнок ДО свадьбы)
- Явная добрачная беременность (< 100 дней)
- Подозрительные случаи (< 260 дней)

#### Проверка имён по святцам
```bash
python3 check_nameday.py tree.ged
python3 check_nameday.py tree.ged --window 8  # окно поиска ±8 дней (по умолчанию)
```

Выводит три категории:
- **Найдены тёзки-родственники** — имя не по святцам, но есть родственник с таким же именем
- **Тёзки не найдены** — имя не по святцам, причина неизвестна
- **Имена по святцам** — имя соответствует святому на дату крещения

#### Поиск родственников-тёзок (отдельный скрипт)
```bash
python3 find_namesakes.py tree.ged
```

#### Валидация дат (детектор аномалий)
```bash
python3 validate_dates.py tree.ged
python3 validate_dates.py tree.ged --before 1920  # только до 1920 года
python3 validate_dates.py tree.ged --output report.txt
```

Находит:
- Смерть до рождения
- Рождение после смерти родителя
- Слишком молодые/старые родители
- Брак до рождения или после смерти
- Большая разница в возрасте супругов

#### Проверка отчеств
```bash
python3 patronymic_check.py tree.ged
python3 patronymic_check.py tree.ged --before 1920
```

Сравнивает отчество ребёнка с именем отца. Выявляет:
- Критические несоответствия (возможная ошибка в данных)
- Нестандартное образование отчества
- Возможных приёмных детей

#### Анализ «кирпичных стен» (тупиков)
```bash
python3 brick_walls.py tree.ged
python3 brick_walls.py tree.ged --from @I1@  # от конкретной персоны
```

Выводит:
- Конечных предков без известных родителей
- Глубину каждой линии предков
- Приоритет исследования (по количеству потомков и данных)
- Подсказки для поиска (места, занятия)

#### Оценка качества данных
```bash
python3 data_quality.py tree.ged
python3 data_quality.py tree.ged --by-century
python3 data_quality.py tree.ged --show-worst 20
```

Выводит:
- Общую оценку качества (0-100)
- Процент персон с датами, местами, родителями
- Распределение по качеству (отлично/хорошо/удовл./плохо)
- Статистику по семьям
- Рекомендации по улучшению

#### Поиск «замещающих имён»
```bash
python3 replacement_names.py tree.ged
python3 replacement_names.py tree.ged --before 1920
python3 replacement_names.py tree.ged --threshold 3  # умершие до 3 лет
```

Находит случаи, когда ребёнка назвали именем умершего младенца в семье:
- Высокая/средняя/низкая уверенность
- Возраст умершего ребёнка
- Время между смертью и рождением замещающего

#### Расчёт коэффициента инбридинга
```bash
python3 inbreeding.py tree.ged
python3 inbreeding.py tree.ged --person @I1@  # для конкретной персоны
python3 inbreeding.py tree.ged --max-gen 10   # глубина поиска предков
```

Рассчитывает COI (Coefficient of Inbreeding) по алгоритму Райта:
- Поиск браков между родственниками
- Расчёт вклада каждого общего предка
- Описание степени родства (двоюродные, троюродные и т.д.)

#### Анализ географической миграции
```bash
python3 migration_analysis.py tree.ged
python3 migration_analysis.py tree.ged --person @I1@  # происхождение персоны
python3 migration_analysis.py tree.ged --top 20        # топ-20 мест
```

Выводит:
- Статистику по населённым пунктам и регионам
- Популярные маршруты миграции
- Географическое происхождение предков конкретной персоны

#### Анализ продолжительности жизни
```bash
python3 longevity.py tree.ged
python3 longevity.py tree.ged --by-century      # по векам
python3 longevity.py tree.ged --by-place        # по местам
python3 longevity.py tree.ged --exclude-infant  # без умерших до 5 лет
```

Выводит:
- Среднюю и медианную продолжительность жизни
- Статистику по полу, периодам, местам
- Список долгожителей
- Анализ детской смертности

#### Статистика поколений
```bash
python3 generation_stats.py tree.ged
python3 generation_stats.py tree.ged --from @I1@  # от конкретной персоны
```

Выводит:
- Интервалы между поколениями (возраст родителей)
- Возраст при рождении первого/последнего ребёнка
- Размер семей (количество детей)
- Многодетные семьи

#### Анализ фамилий
```bash
python3 surname_analysis.py tree.ged
python3 surname_analysis.py tree.ged --surname Попов  # детально по фамилии
python3 surname_analysis.py tree.ged --etymology      # с этимологией
```

Выводит:
- Топ фамилий по количеству носителей
- Происхождение фамилий (патронимические, профессиональные, географические)
- Мужскую линию для конкретной фамилии
- Редкие фамилии

---

### Семейные паттерны

#### Анализ сиблингов (братьев и сестёр)
```bash
python3 sibling_analysis.py tree.ged
python3 sibling_analysis.py tree.ged --min-children 5  # семьи с 5+ детьми
python3 sibling_analysis.py tree.ged --output report.txt
```

Выводит:
- Интервалы между рождениями детей
- Детская смертность в семьях
- Соотношение полов среди детей
- Порядок рождения и выживаемость

#### Паттерны браков
```bash
python3 marriage_patterns.py tree.ged
python3 marriage_patterns.py tree.ged --period 1850-1900
python3 marriage_patterns.py tree.ged --output report.txt
```

Выводит:
- Возраст вступления в брак по полу
- Разница в возрасте супругов
- Эндогамия (браки внутри группы) vs экзогамия
- Тренды по десятилетиям

#### Повторные браки
```bash
python3 multiple_marriages.py tree.ged
python3 multiple_marriages.py tree.ged --person @I1@
```

Выводит:
- Статистика вдовства и повторных браков
- Интервалы между браками
- Причины повторных браков (смерть супруга)
- Дети от разных браков

---

### Социально-историческая аналитика

#### Анализ профессий и сословий
```bash
python3 occupation_analysis.py tree.ged
python3 occupation_analysis.py tree.ged --person @I1@
python3 occupation_analysis.py tree.ged --output report.txt
```

Выводит:
- Распределение по сословиям (дворяне, крестьяне, мещане и т.д.)
- Социальная мобильность (движение вверх/вниз)
- Наследуемые профессии
- Тренды по периодам

#### Влияние войн на демографию
```bash
python3 war_impact.py tree.ged
python3 war_impact.py tree.ged --war "Великая Отечественная"
python3 war_impact.py tree.ged --output report.txt
```

Анализирует влияние войн:
- Отечественная война 1812, Крымская, Русско-турецкие
- Первая мировая, Гражданская
- Великая Отечественная, Афганская

Выводит:
- Смерти в призывном возрасте
- Падение рождаемости
- Отложенные браки

#### Детекция эпидемий
```bash
python3 epidemic_detection.py tree.ged
python3 epidemic_detection.py tree.ged --threshold 2.0  # Z-score порог
python3 epidemic_detection.py tree.ged --output report.txt
```

Находит:
- Аномальные кластеры смертей
- Соотнесение с известными эпидемиями (холера, тиф, испанка)
- Локальные вспышки болезней

#### Анализ сирот
```bash
python3 orphan_analysis.py tree.ged
python3 orphan_analysis.py tree.ged --output report.txt
```

Выводит:
- Возраст при потере родителей
- Полные сироты vs потерявшие одного родителя
- Влияние на продолжительность жизни
- Исторические паттерны сиротства

---

### Специфические паттерны

#### Поиск близнецов
```bash
python3 twin_detection.py tree.ged
python3 twin_detection.py tree.ged --max-days 3  # максимум 3 дня разницы
```

Выводит:
- Вероятные близнецы (высокая/средняя/низкая уверенность)
- Близнецовость в семьях
- Выживаемость близнецов

#### Тренды имён
```bash
python3 name_trends.py tree.ged
python3 name_trends.py tree.ged --name Иван  # детально по имени
python3 name_trends.py tree.ged --top 30     # топ-30 имён
```

Выводит:
- Популярные имена по периодам
- Редкие и уникальные имена
- Период использования имён
- Нормализация вариантов (Саша → Александр)

#### Сеть крёстных родителей
```bash
python3 godparent_network.py tree.ged
python3 godparent_network.py tree.ged --person @I1@
```

Выводит:
- Связи крёстный-крестник
- Родственники vs не-родственники среди крёстных
- «Профессиональные» крёстные (много крестников)
- Социальные паттерны кумовства

#### Анализ причин смерти
```bash
python3 cause_of_death.py tree.ged
python3 cause_of_death.py tree.ged --period 1850-1920
python3 cause_of_death.py tree.ged --cause "холера"
python3 cause_of_death.py tree.ged --category инфекционные
```

Выводит:
- Категоризация причин (инфекции, несчастные случаи, старость и т.д.)
- Распределение по десятилетиям и возрастным группам
- Терминология метрических книг («горячка», «чахотка»)
- Средний возраст смерти по категориям

#### Анализ свидетелей
```bash
python3 witness_analysis.py tree.ged
python3 witness_analysis.py tree.ged --person @I1@
python3 witness_analysis.py tree.ged --event marriage
```

Выводит:
- Поручители на свадьбах, восприемники на крещениях
- Топ «профессиональных» свидетелей
- Частые пары свидетелей
- Родственники vs не-родственники среди свидетелей

---

### Экспорт и визуализация

#### Экспорт в таймлайн
```bash
python3 timeline_export.py tree.ged -f json -o events.json
python3 timeline_export.py tree.ged -f csv -o events.csv
python3 timeline_export.py tree.ged -f html -o timeline.html
python3 timeline_export.py tree.ged -f html --from-year 1800 --to-year 1900 -o timeline.html
```

Форматы:
- **JSON** — для программной обработки
- **CSV** — для Excel/Google Sheets
- **HTML** — интерактивный таймлайн для браузера

#### Общая статистика древа
```bash
python3 tree_statistics.py tree.ged
python3 tree_statistics.py tree.ged --output report.txt
```

Выводит:
- Общие цифры (персоны, семьи, поколения)
- Полнота данных по персонам
- Демографическая статистика
- Качество данных и рекомендации

## Православная традиция именования

В православной традиции ребёнка называли в честь святого, память которого приходилась на:
- День рождения
- 8-й день от рождения (день наречения имени)
- День крещения
- Ближайший день после рождения с подходящим святым

Если имя не соответствует святцам, ребёнок мог быть назван в честь родственника:
- Родители, бабушки и дедушки
- Крёстные (если указаны в GEDCOM через ASSO с RELA godparent)
- Тёти и дяди
- Старшие братья и сёстры (особенно умершие — традиция «замещающих» имён)

Скрипт `check_nameday.py` автоматически ищет родственников-тёзок для имён, не соответствующих святцам.

## Традиция «замещающих имён»

При высокой детской смертности (до XX века) была распространена традиция называть следующего ребёнка того же пола именем умершего младенца. Причины:
- Желание «сохранить» имя в семье
- Вера в переселение души
- Традиция называть в честь святого-покровителя
- Ограниченный набор принятых имён

Скрипт `replacement_names.py` находит такие случаи, анализируя:
- Повторяющиеся имена среди детей одного пола
- Факт смерти первого ребёнка в младенчестве
- Рождение второго ребёнка после смерти первого

## Православные свадебные традиции

### Разрешённые периоды для венчания

1. **Зимний свадебник** (~66% браков)
   - От Крещения (7/19-20 января) до Масленицы

2. **Весенний свадебник** (~12%)
   - От Красной горки (первое воскресенье после Пасхи) до Троицы

3. **Осенний свадебник** (~22%)
   - От Покрова (1/14 октября) до Филиппова заговенья (14/27 ноября)

### Запретные периоды

- Великий пост (48 дней до Пасхи)
- Петров пост (после Троицы до 29 июня)
- Успенский пост (1-14 августа)
- Рождественский пост (15 ноября - 24 декабря)

## Конфиденциальность данных

**ВАЖНО:** Никогда не коммитьте GEDCOM файлы с реальными генеалогическими данными в публичные репозитории. Файл `.gitignore` по умолчанию исключает `*.ged` файлы.

## Поддержка формата GEDCOM

Поддерживается GEDCOM 5.5.1:
- Даты по юлианскому календарю (`@#DJULIAN@`)
- Приблизительные даты (ABT, BEF, AFT)
- Стандартные форматы дат

## Лицензия

MIT License

## Участие в разработке

Приветствуются pull request'ы и предложения по улучшению!
