# Genealogy Analyzer — скилл для Claude Code

**Автор:** Константин Попов ([tamvodopad.com](https://tamvodopad.com))

Скилл для Claude Code, анализирующий генеалогические данные в формате GEDCOM. Специализация — поиск аномалий в датах браков, рождений и смертей с учётом русских православных традиций (до 1917 года).

## Возможности

- **Аналитика рождений** — распределение по годам, месяцам, сезонам зачатия
- **Анализ дат браков** на соответствие православным традициям
- **Поиск браков в запретные периоды** (посты)
- **Выявление нетипичных дат свадеб** (лето, страда)
- **Проверка дат рождения первых детей** относительно брака (добрачная беременность)
- **Проверка соответствия имён дням крещения по святцам**
- **Поиск родственников-тёзок** для имён, не соответствующих святцам
- Поддержка юлианского календаря

## Установка

### Claude Code

1. Клонируйте репозиторий:
```bash
git clone https://github.com/tamvodopad/claude-code-skill-genealogy-analyzer.git
```

2. Создайте символическую ссылку в директории скиллов:
```bash
ln -s /path/to/claude-code-skill-genealogy-analyzer ~/.claude/skills/genealogy-analyzer
```

Или скопируйте файлы:
```bash
cp -r claude-code-skill-genealogy-analyzer ~/.claude/skills/genealogy-analyzer
```

3. Скилл автоматически станет доступен в Claude Code.

**Проверка:** запустите `claude` и попросите «проанализируй GEDCOM файл на аномалии».

---

### OpenAI Codex CLI

[Codex CLI](https://developers.openai.com/codex/cli/) поддерживает скиллы в формате, совместимом с этим репозиторием.

1. Убедитесь, что скиллы включены в `~/.codex/config.toml`

2. Клонируйте репозиторий в директорию скиллов Codex:
```bash
git clone https://github.com/tamvodopad/claude-code-skill-genealogy-analyzer.git ~/.codex/skills/genealogy-analyzer
```

3. Переименуйте файл скилла (Codex использует `SKILL.md`):
```bash
cd ~/.codex/skills/genealogy-analyzer
# SKILL.md уже есть в репозитории, Codex его подхватит
```

4. Перезапустите Codex CLI.

**Документация:** [Create Skills](https://developers.openai.com/codex/skills/create-skill/) | [Skills Catalog](https://github.com/openai/skills)

---

### Yandex Алиса AI

> ⚠️ **Важно:** Навыки Алисы — это веб-сервисы, отвечающие на голосовые команды. Этот скилл предназначен для локального анализа файлов и **не может быть напрямую использован** как навык Алисы.

Однако, можно создать навык-обёртку:

1. **Создайте веб-сервис** на Python/Node.js, который:
   - Принимает GEDCOM файл (через загрузку или ссылку)
   - Запускает скрипты анализа
   - Возвращает результаты голосом

2. **Зарегистрируйте навык** в [Яндекс Диалогах](https://dialogs.yandex.ru/development)

3. **Разверните backend** через [Yandex Cloud Functions](https://cloud.yandex.ru/docs/functions/tutorials/alice-skill)

**Пример интеграции:**
```python
# handler.py для Yandex Cloud Functions
import json
from analyze_marriages import analyze_marriages_data

def handler(event, context):
    # Парсим запрос от Алисы
    request = json.loads(event['body'])
    command = request['request']['command']

    if 'анализ браков' in command.lower():
        # Анализируем заранее загруженный файл
        result = analyze_marriages_data('/tmp/tree.ged')
        response_text = f"Найдено {result['total']} браков. {result['forbidden']} в запретные периоды."
    else:
        response_text = "Скажите: анализ браков"

    return {
        'statusCode': 200,
        'body': json.dumps({
            'response': {'text': response_text, 'end_session': False},
            'version': '1.0'
        })
    }
```

**Документация:** [Разработка навыков](https://yandex.ru/dev/dialogs/alice/doc/ru/quickstart-about.html) | [Примеры на GitHub](https://github.com/yandex/alice-skills)

## Использование

Скилл активируется когда вы:
- Просите проанализировать GEDCOM файл на аномалии
- Хотите найти нетипичные даты браков
- Спрашиваете о соответствии дат православным традициям
- Просите исследовать конкретную семью

### Примеры запросов

- «Проанализируй мой GEDCOM файл на аномалии»
- «Найди нетипичные даты браков в tree.ged»
- «Проверь, соответствует ли эта дата брака православным традициям»
- «Найди браки в запретные периоды до 1930 года»

### Автономные скрипты

#### Аналитика по датам рождения
```bash
python3 analyze_births.py tree.ged           # Базовая аналитика
python3 analyze_births.py tree.ged --list    # С полным списком рождений
```

Выводит:
- Распределение по десятилетиям и месяцам
- Сезоны зачатия (рождение минус 9 месяцев)
- Самые ранние и поздние рождения
- Пиковые годы рождений

#### Анализ дат браков
```bash
python3 analyze_marriages.py tree.ged
python3 analyze_marriages.py tree.ged --before 1920
python3 analyze_marriages.py tree.ged --before 1930 --output report.txt
```

Выводит:
- Браки в запретные периоды (посты)
- Нетипичные даты (лето, страда)
- Типичные свадебные периоды

#### Проверка дат рождения первых детей
```bash
python3 check_first_child.py tree.ged
python3 check_first_child.py tree.ged --threshold 200  # Порог в днях
```

Выявляет возможную добрачную беременность:
- Критические случаи (ребёнок ДО свадьбы)
- Явная добрачная беременность (< 100 дней)
- Подозрительные случаи (< 260 дней)

#### Проверка имён по святцам
```bash
python3 check_nameday.py tree.ged
python3 check_nameday.py tree.ged --window 8  # окно поиска ±8 дней (по умолчанию)
```

Выводит три категории:
- **Найдены тёзки-родственники** — имя не по святцам, но есть родственник с таким же именем
- **Тёзки не найдены** — имя не по святцам, причина неизвестна
- **Имена по святцам** — имя соответствует святому на дату крещения

#### Поиск родственников-тёзок (отдельный скрипт)
```bash
python3 find_namesakes.py tree.ged
```

## Православная традиция именования

В православной традиции ребёнка называли в честь святого, память которого приходилась на:
- День рождения
- 8-й день от рождения (день наречения имени)
- День крещения
- Ближайший день после рождения с подходящим святым

Если имя не соответствует святцам, ребёнок мог быть назван в честь родственника:
- Родители, бабушки и дедушки
- Крёстные (если указаны в GEDCOM через ASSO с RELA godparent)
- Тёти и дяди
- Старшие братья и сёстры (особенно умершие — традиция «замещающих» имён)

Скрипт `check_nameday.py` автоматически ищет родственников-тёзок для имён, не соответствующих святцам.

## Православные свадебные традиции

### Разрешённые периоды для венчания

1. **Зимний свадебник** (~66% браков)
   - От Крещения (7/19-20 января) до Масленицы

2. **Весенний свадебник** (~12%)
   - От Красной горки (первое воскресенье после Пасхи) до Троицы

3. **Осенний свадебник** (~22%)
   - От Покрова (1/14 октября) до Филиппова заговенья (14/27 ноября)

### Запретные периоды

- Великий пост (48 дней до Пасхи)
- Петров пост (после Троицы до 29 июня)
- Успенский пост (1-14 августа)
- Рождественский пост (15 ноября - 24 декабря)

## Конфиденциальность данных

**ВАЖНО:** Никогда не коммитьте GEDCOM файлы с реальными генеалогическими данными в публичные репозитории. Файл `.gitignore` по умолчанию исключает `*.ged` файлы.

## Поддержка формата GEDCOM

Поддерживается GEDCOM 5.5.1:
- Даты по юлианскому календарю (`@#DJULIAN@`)
- Приблизительные даты (ABT, BEF, AFT)
- Стандартные форматы дат

## Лицензия

MIT License

## Участие в разработке

Приветствуются pull request'ы и предложения по улучшению!
